<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div th:replace="~{fragments/navbar :: navbar}"></div>

<div class="container mt-5">
    <h2>Welcome, <span id="username" th:text="${username}">User</span>!</h2>

    <div id="adminSection" style="display:none;">
      <h3>Create New Tour</h3>
      <form id="createTourForm" class="row g-3 mb-4">
          <div class="col-md-4">
              <input type="text" id="tourName" class="form-control" placeholder="Tour Name" required>
          </div>
          <div class="col-md-4">
              <select id="tourCity" class="form-select" required>
                  <option value="">Loading cities...</option>
              </select>
          </div>
          <div class="col-md-2">
              <input type="number" id="tourPrice" class="form-control" placeholder="Price" required>
          </div>
          <div class="col-md-2">
              <input type="number" id="tourSeats" class="form-control" placeholder="Seats" required>
          </div>
          <div class="col-md-3">
              <input type="date" id="tourStartDate" class="form-control" required>
          </div>
          <div class="col-md-3">
              <input type="date" id="tourEndDate" class="form-control" required>
          </div>
          <div class="col-md-2">
              <button type="submit" class="btn btn-success">Create Tour</button>
          </div>
      </form>
  </div>


    <hr>
    <h3>Available Tours</h3>
    <div class="row mb-3">
        <div class="col-md-4">
            <input type="text" id="searchInput" class="form-control" placeholder="Search by name or city">
        </div>
        <div class="col-md-4">
            <select id="sortSelect" class="form-select">
                <option value="startDate">Sort by Start Date</option>
                <option value="price">Sort by Price</option>
                <option value="availableSeats">Sort by Seats</option>
            </select>
        </div>
    </div>
    <div id="tourList" class="row"></div>

    <hr>
    <div id="orderSection">
        <h3>My Orders</h3>
        <div id="orderList" class="row"></div>
        <p id="noOrdersMsg" class="text-muted" style="display: none;">You have no orders. Book a tour to get started!</p>
    </div>
</div>

<div id="dashboardToast" class="toast position-fixed bottom-0 end-0 p-3" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="toast-header">
        <strong class="me-auto">Notification</strong>
        <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
    </div>
    <div class="toast-body" id="dashboardToastMessage"></div>
</div>

<!-- Book Modal -->
<div class="modal fade" id="bookModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Confirm Booking</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        Do you really want to book tour: <b id="bookModalTourName"></b>?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button id="bookModalConfirm" class="btn btn-primary">Confirm</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="cancelModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cancel Booking?</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        Are you sure you want to cancel booking for: <b id="cancelModalTourName"></b>?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
        <button id="cancelModalConfirm" class="btn btn-danger">Cancel Order</button>
      </div>
    </div>
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script th:src="@{/js/dashboard.js}"></script> 
<script th:src="@{/js/tour.js}"></script>
</body>
</html>